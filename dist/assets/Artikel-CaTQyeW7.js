import{r as i,j as e}from"./index-B2A0ZtH7.js";import{A as J,a as R,E as N}from"./EmptyState-BFvOHbsS.js";import{a as m}from"./index-C0RmN517.js";import{A as T,L as G}from"./LoadingSpinner-A245_0JZ.js";import"./iconBase-GOSsFjr7.js";import"./index-B8JxVmVg.js";const p="https://txhxqrwzwgivxvvnwpnk.supabase.co/rest/v1/artikel",v="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4aHhxcnd6d2dpdnh2dm53cG5rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyODQ5NDIsImV4cCI6MjA2NDg2MDk0Mn0.QgAyKR-P6khZsSWtG5Su1UOMPqS5piCqZ7WT5mAh4TY",x={apikey:v,Authorization:`Bearer ${v}`,"Content-Type":"application/json"},h={async fetchArtikel(){return(await m.get(p,{headers:x})).data},async createArtikel(r){return(await m.post(p,r,{headers:x})).data},async deleteArtikel(r){await m.delete(`${p}?id=eq.${r}`,{headers:x})},async updateArtikel(r,o){return(await m.patch(`${p}?id=eq.${r}`,o,{headers:x})).data}},q=()=>{const[r,o]=i.useState([]),[b,L]=i.useState(""),[t,d]=i.useState({id:"",judul:"",penulis:"",isi:"",gambar:[]}),[c,k]=i.useState(null),[g,w]=i.useState(!0),[y,l]=i.useState({type:"",message:""}),j=async()=>{w(!0);try{const a=await h.fetchArtikel();o(a)}catch{l({type:"error",message:"Gagal memuat artikel."})}finally{w(!1)}};i.useEffect(()=>{j()},[]);const u=a=>{const{name:s,value:n,files:A}=a.target;if(s==="gambar"){if(A.length>10){l({type:"error",message:"Maksimal 10 gambar."});return}const D=Array.from(A).map(f=>URL.createObjectURL(f));d(f=>({...f,gambar:D}))}else d({...t,[s]:n})},I=async a=>{if(a.preventDefault(),!t.judul||!t.penulis||!t.isi||t.gambar.length===0){l({type:"error",message:"Semua field wajib diisi."});return}const s={judul:t.judul,penulis:t.penulis,isi:t.isi,gambar:t.gambar};try{c?(await h.updateArtikel(c,s),l({type:"success",message:"Artikel berhasil diperbarui."}),k(null)):(await h.createArtikel(s),l({type:"success",message:"Artikel berhasil ditambahkan."})),d({id:"",judul:"",penulis:"",isi:"",gambar:[]}),j()}catch{l({type:"error",message:"Gagal menyimpan data ke Supabase."})}},S=a=>{const s=r.find(n=>n.id===a);s&&(d({id:s.id,judul:s.judul,penulis:s.penulis,isi:s.isi,gambar:Array.isArray(s.gambar)?s.gambar:s.gambar?[s.gambar]:[]}),k(a))},C=a=>{const s=[...t.gambar];s.splice(a,1),d(n=>({...n,gambar:s}))},E=async a=>{if(window.confirm("Hapus artikel ini?"))try{await h.deleteArtikel(a),l({type:"success",message:"Artikel berhasil dihapus."}),j()}catch{l({type:"error",message:"Gagal menghapus artikel."})}};return e.jsxs("div",{className:"p-6 bg-gray-100 min-h-screen",children:[e.jsxs("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-md p-6 mb-10",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:c?"Edit Artikel":"Tambah Artikel"}),y.message&&e.jsx(T,{type:y.type,children:y.message}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsx("input",{type:"text",name:"judul",placeholder:"Judul",value:t.judul,onChange:u,className:"w-full p-2 bg-gray-50 border rounded-xl"}),e.jsx("input",{type:"text",name:"penulis",placeholder:"Penulis",value:t.penulis,onChange:u,className:"w-full p-2 bg-gray-50 border rounded-xl"}),e.jsx("textarea",{name:"isi",placeholder:"Isi Artikel",value:t.isi,onChange:u,rows:4,className:"w-full p-2 bg-gray-50 border rounded-xl"}),e.jsx("input",{type:"file",name:"gambar",multiple:!0,accept:"image/*",onChange:u,className:"bg-blue-500 border-2 border-white rounded-xl px-2 py-1 text-white size-1/8"}),Array.isArray(t.gambar)&&t.gambar.map((a,s)=>e.jsxs("div",{className:"w-16 h-16 border rounded overflow-hidden relative",children:[e.jsx("img",{src:a,alt:`preview-${s}`,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>C(s),className:"absolute top-0 right-0 bg-red-500 text-white text-xs px-1 cursor-pointer rounded-full",children:"âœ•"})]},s)),e.jsx("button",{type:"submit",className:"bg-coklat hover:bg-coklat2 text-white px-6 py-2 rounded-xl shadow",children:c?"Update":"Tambah"})]})]}),e.jsxs("div",{className:"max-w-6xl mx-auto bg-white rounded-xl shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Daftar Artikel"}),g?e.jsx(G,{text:"Memuat artikel..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700 text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 border-b",children:"Judul"}),e.jsx("th",{className:"px-6 py-3 border-b",children:"Penulis"}),e.jsx("th",{className:"px-6 py-3 border-b",children:"Isi"}),e.jsx("th",{className:"px-6 py-3 border-b text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:r.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 text-sm text-gray-700",children:[e.jsx("td",{className:"px-6 py-4 border-b",children:a.judul}),e.jsx("td",{className:"px-6 py-4 border-b",children:a.penulis}),e.jsx("td",{className:"px-6 py-4 border-b",children:a.isi.length>100?a.isi.substring(0,100)+"...":a.isi}),e.jsx("td",{className:"px-6 py-4 border-b text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>S(a.id),className:"hover:bg-orange-100 rounded-full p-2",children:e.jsx(J,{className:"text-orange-500 text-xl cursor-pointer"})}),e.jsx("button",{onClick:()=>E(a.id),className:"hover:bg-red-100 rounded-full p-2",children:e.jsx(R,{className:"text-red-500 text-xl cursor-pointer"})})]})})]},a.id))})]})}),!g&&r.length===0&&!b&&e.jsx(N,{text:"Belum ada daftar artikel yang dibuat! Tambah Artikel Sekarang"}),!g&&r.length===0&&b&&e.jsx(N,{text:"Terjadi Kesalahan. Coba lagi nanti."})]})]})};export{q as default};
